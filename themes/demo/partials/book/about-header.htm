{% set typeEbook = constant('Books\\Book\\Classes\\Enums\\EditionsEnums::Ebook') %}
{% set typeAudiobook = constant('Books\\Book\\Classes\\Enums\\EditionsEnums::Audio') %}

{% set ebook = book.editions.where('type', typeEbook).first %}
{% set audiobook = book.editions.where('type', typeAudiobook).first %}

<div class="about-book__header ui-container-fluid">
    <div class="listing-book__book book-card">
        <div class="book-card__body">
            <div class="book-card__column-left">
                <a href="/book-card/{{book.id}}">
                    <img class="book-card__image"
                         src="{{ book.cover.path }}"
                         style="object-fit: fill"
                         alt=""
                         loading="lazy"/>
                </a>
            </div>
            <div class="book-card__column-right">
                <a href="/book-card/{{book.id}}"
                   class="book-card__title ui-text-head--2 ui-text--bold">{{book.title}}</a>
                <div class="book-card__raiting">
                    <svg>
                        <use xlink:href="{{'assets/icon-sprite/svg-sprite.svg#star-filled-16' | theme}}"></use>
                    </svg>
                    <span>{{book.stats.rate ?:0}}</span>
                </div>
                <div class="book-card__body-footer">

                    <div class="book-card__book-list tags-list">
                        {% partial 'controls/genres-link-list' genres=book.genres %}
                    </div>
                </div>
                <div class="book-card__genres tags-list">
                    {% partial 'controls/tags-link-list' tags=book.tags %}
                </div>

                {% if ebook %}
                    <div class="chapter-book__info-container">
                        <div class="book-card__info-wrapper">
                            {% partial 'book/edition-info' edition=ebook %}
                            {% partial 'site/book-status' edition=ebook %}
                            {% if ebook.sales_at %}
                            <div class="book-card__info-dot"></div>
                            <div class="book-card__info-wrap _text">{{ carbon(ebook.sales_at).format('d.m.y') }}</div>
                            {% endif %}
                            <div class="book-card__info-dot"></div>
                            {% if ebook.length %}
                            <div class="book-card__info-wrap _text">{{ebook.length}}&thinsp;зн.</div>
                            {% endif %}
                        </div>
                    </div>

                    {% if ebook.is_deferred %}
                    <div class="chapter-book__info-container" id="ebook_is_deferred">
                        <div class="chapter-book__status">

                            <svg class="square-16 attention">
                                <use xlink:href="{{'assets/icon-sprite/svg-sprite.svg#info-stroked-24' | theme}}"></use>
                            </svg>

                            <span>Редактирование глав электронного издания только через подтверждение от администратора&nbsp;</span>
                            <span class="ui-tooltip square-16"
                                  data-tooltip="Правки вступят в силу после того, как модератор проверит и примет их">
                                <svg class="square-16">
                                    <use
                                        xlink:href="{{'assets/icon-sprite/svg-sprite.svg#questions-stroked-circle-16' | theme}}">
                                    </use>
                                </svg>
                            </span>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}

                {% if audiobook %}
                    <div class="chapter-book__info-container">
                        <div class="book-card__info-wrapper">
                            {% partial 'book/edition-info' edition=audiobook %}
                            {% partial 'site/book-status' edition=audiobook %}
                            {% if audiobook.sales_at %}
                            <div class="book-card__info-dot"></div>
                            <div class="book-card__info-wrap _text">{{ carbon(audiobook.sales_at).format('d.m.y') }}</div>
                            {% endif %}
                            <div class="book-card__info-dot"></div>
                            {% if audiobook.length %}
                            <div class="book-card__info-wrap _text">{{ audiobook.audio_length }}&thinsp;</div>
                            {% endif %}
                        </div>
                    </div>

                    {% if audiobook.is_deferred %}
                        <div class="chapter-book__info-container" id="audiobook_is_deferred">


                            <div class="chapter-book__status">

                                <svg class="square-16 attention">
                                    <use xlink:href="{{'assets/icon-sprite/svg-sprite.svg#info-stroked-24' | theme}}"></use>
                                </svg>

                                <span>Редактирование глав аудиокниги только через подтверждение от администратора&nbsp;</span>
                                <span class="ui-tooltip square-16"
                                      data-tooltip="Правки вступят в силу после того, как модератор проверит и примет их">
                                      <svg class="square-16">
                                        <use xlink:href="{{'assets/icon-sprite/svg-sprite.svg#questions-stroked-circle-16' | theme}}"></use>
                                    </svg>
                                </span>
                            </div>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>
