<div class="ui-container">
    <div class="create-book__title ui-text-head--2 ui-text--bold">Добавление текста</div>
</div>

<form class="lc-book-text ui-container-fluid wrapper" data-request="{{__SELF__}}::onSave" data-request-validate>
    <div class="personal-area__wrap _indent-large ui-input">
        <label class="ui-input-label">Название части</label>
        <input class="ui-input-item _size-32" value="{{chapter.title}}" name="title" type="text">
        <span class="validation-error" data-validate-for="title"></span>
    </div>

    <div class="personal-area__wrap _indent-large">
        <textarea name="chapter_content">{{chapter.content}}</textarea>
    </div>
    <span class="validation-error" data-validate-for="content"></span>
    <span class="validation-error" data-validate-for="chapter_content"></span>

    <div class="personal-area__wrap _indent-large">
        <label class="personal-area__wrap _indent-medium ui-radio">
            <input type="radio" name="action" value="publish_now" class="chapter-action-radio"
                   {{ chapter.status.value == 'published' and not chapter.published_at ? 'checked':'' }}
            hidden>
            <div class="ui-radio-checker"></div>
            <span class="ui-radio-text">Опубликовать сейчас</span>
        </label>
        <label class="personal-area__wrap _indent-medium ui-radio">
            <input type="radio" name="action" value="save_as_draft" class="chapter-action-radio"
                   {{ chapter.id ? (chapter.status.value == 'draft' ? 'checked':'') : 'checked' }}

                   hidden>
            <div class="ui-radio-checker"></div>
            <span class="ui-radio-text">Сохранить как черновик</span>
        </label>
        <label class="personal-area__wrap _indent-medium ui-radio">
            <input type="radio" id="published_at_radio" value="published_at" class="chapter-action-radio"
                   {{ chapter.status.value == 'published' and chapter.published_at ? 'checked':'' }}
            name="action" hidden>
            <div class="ui-radio-checker"></div>
            <span class="ui-radio-text">Назначить дату публикации</span>
        </label>

        <div class="personal-area__wrap _indent-small ui-input" id="published_at_input" style="display: none">
            <label class="ui-input-label">Дата публикации</label>
            <input class="ui-input-item _size-32"  name="published_at" value="{{chapter.published_at ? carbon(chapter.published_at).format('Y-m-d\TH:i') : ''}}"  type="datetime-local">
        </div>
        <span class="validation-error" data-validate-for="published_at"></span>
        <span class="validation-error" data-validate-for="action"></span>
    </div>

    <button href="#" class="ui-button ui-button-size--32 ui-button-view--2" >{{chapter.id ? 'Сохранить' : 'Добавить'}}</button>
</form>

<script>
    if (!document.getElementById('cke_chapter_content')) {
        CKEDITOR.replace('chapter_content');
    }
    $('.chapter-action-radio').on('change', function (e) {
        let input = $('#published_at_input')
        if (e.target.id === 'published_at_radio') {
            input.show()
        } else {
            input.hide()
        }
    })
    if(document.querySelector('input[class = "chapter-action-radio"]:checked').id == 'published_at_radio'){
        $('#published_at_input').show()
    }
</script>
